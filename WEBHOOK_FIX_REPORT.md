# üîß –ó–í–Ü–¢ –ü–†–û –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø WEBHOOK/POLLING –ö–û–ù–§–õ–Ü–ö–¢–£

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞, —â–æ –±—É–ª–∞:
```
TelegramConflictError: Telegram server says - Conflict: can't use getUpdates method while webhook is active; use deleteWebhook to delete the webhook first
```

## üîç –ê–Ω–∞–ª—ñ–∑ –ø—Ä–∏—á–∏–Ω:

### 1. **–ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞**: 
–ë–æ—Ç –Ω–∞–º–∞–≥–∞–≤—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ webhook —Ç–∞ polling, —â–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ Telegram API.

### 2. **–ì–ª–∏–±–æ–∫–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∏—è–≤–∏–ª–∞**:
- –ù–µ—Ç–æ—á–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É —Ä–æ–±–æ—Ç–∏
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ–≥–æ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è webhook —Ç–∞ polling –≤–∏–∫–ª–∏–∫—ñ–≤
- –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—î –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üöÄ –†—ñ—à–µ–Ω–Ω—è (3 –µ—Ç–∞–ø–∏):

### –ö–†–û–ö 1: –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –∫–æ–¥—É ‚úÖ
- –ó–Ω–∞–π–¥–µ–Ω–æ –≤—Å—ñ –≤–∏–∫–ª–∏–∫–∏ `start_polling` –≤ –ø—Ä–æ–µ–∫—Ç—ñ
- –í–∏—è–≤–ª–µ–Ω–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –≤ main.py
- –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ handlers —Ç–∞ middleware

### –ö–†–û–ö 2: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ENVIRONMENT ‚úÖ
- –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ `os.getenv()` —Ç–∞ `config.py`
- –ü–æ–¥–≤—ñ–π–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ä–µ–∂–∏–º—É —Ä–æ–±–æ—Ç–∏

### –ö–†–û–ö 3: –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è ‚úÖ
- **–ü–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–æ main.py** –∑ –Ω—É–ª—è
- –°—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–∏–º—É—Å–æ–≤–∏–π —Ä–µ–∂–∏–º –∑ `FORCE_WEBHOOK_MODE`
- –†–æ–∑–¥—ñ–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó: `start_webhook_server()` —Ç–∞ `start_polling_server()`

## üîß –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏:

### –ù–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É:
```python
# –ö–†–ò–¢–ò–ß–ù–ò–ô –ë–õ–û–ö –í–ò–ó–ù–ê–ß–ï–ù–ù–Ø –†–ï–ñ–ò–ú–£
if ENVIRONMENT == "production" or raw_env == "production":
    FORCE_WEBHOOK_MODE = True
    logger.info("‚úÖ –†–ï–ñ–ò–ú: PRODUCTION - –ü–†–ò–ú–£–°–û–í–ò–ô WEBHOOK!")
else:
    FORCE_WEBHOOK_MODE = False
    logger.info("‚ö†Ô∏è –†–ï–ñ–ò–ú: DEVELOPMENT - –î–û–ó–í–û–õ–ï–ù–ò–ô POLLING")
```

### –ü—Ä–∏–º—É—Å–æ–≤–∏–π webhook –¥–ª—è production:
```python
async def force_webhook_mode():
    """–ü–†–ò–ú–£–°–û–í–ï –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è webhook –¥–ª—è production"""
    # –°–ø–æ—á–∞—Ç–∫—É –û–ë–û–í'–Ø–ó–ö–û–í–û –≤–∏–¥–∞–ª—è—î–º–æ –±—É–¥—å-—è–∫—ñ webhook'–∏
    await bot.delete_webhook(drop_pending_updates=True)
    await asyncio.sleep(2)  # –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ
    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–æ–≤–∏–π webhook...
```

### –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–µ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤:
```python
async def main():
    if FORCE_WEBHOOK_MODE:
        await start_webhook_server()  # –¢–Ü–õ–¨–ö–ò webhook
    else:
        await start_polling_server()  # –¢–Ü–õ–¨–ö–ò polling
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:

### –î–û –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
```
‚ùå TelegramConflictError: can't use getUpdates method while webhook is active
‚ùå –ë–æ—Ç –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–≤ –Ω–∞ Render
‚ùå –ù–µ–º–æ–∂–ª–∏–≤–æ –±—É–ª–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç–∞
```

### –ü–Ü–°–õ–Ø –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
```
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –≤–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É (production/development)
‚úÖ –ü—Ä–∏–º—É—Å–æ–≤–∏–π webhook –¥–ª—è Render –±–µ–∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É
‚úÖ –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
‚úÖ Polling –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏
‚úÖ –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–µ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ–≥–æ webhook+polling
```

## üéØ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:

### Production (Render):
```
Telegram API ‚Üí https://prometeylabs-telegram-bot.onrender.com/webhook/8112513772 ‚Üí Bot
```

### Development (–ª–æ–∫–∞–ª—å–Ω–æ):
```
Bot ‚Üê getUpdates API ‚Üê Telegram API
```

## üìä Endpoint'–∏:

- **Health Check**: `/health` - "PrometeyLabs Bot is running! üöÄ"
- **Webhook**: `/webhook/8112513772` - –ø—Ä–∏–π–º–∞—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥ Telegram
- **–ì–æ–ª–æ–≤–Ω–∞**: `/` - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–∞ health check

## üîí –ì–∞—Ä–∞–Ω—Ç—ñ—ó:

1. **–ù–µ–º–æ–∂–ª–∏–≤–∏–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç**: –ö–æ–¥ —Ñ—ñ–∑–∏—á–Ω–æ –Ω–µ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ polling –≤ production
2. **–ü–æ–¥–≤—ñ–π–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞**: `ENVIRONMENT` —Ç–∞ `os.getenv('ENVIRONMENT')`
3. **–ü—Ä–∏–º—É—Å–æ–≤–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è**: –í—Å—ñ —Å—Ç–∞—Ä—ñ webhook'–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è–º –Ω–æ–≤–∏—Ö
4. **–î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è**: –ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—É—î—Ç—å—Å—è –≤ –ª–æ–≥–∞—Ö

## üöÄ –î–µ–ø–ª–æ–π:

1. –ö–æ–¥ –∑–∞–ø—É—à–µ–Ω–æ –≤ main –≥—ñ–ª–∫—É
2. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–µ–ø–ª–æ—ó—Ç—å
3. ENVIRONMENT=production –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫—Ç–∏–≤—É—î webhook
4. –ë–æ—Ç –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫

## üéâ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚ùå –ü–æ–º–∏–ª–∫–∞ "can't use getUpdates method while webhook is active" **–ó–ù–ò–ö–ù–ï**
- ‚úÖ –ë–æ—Ç –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —Å—Ç–∞–±—ñ–ª—å–Ω–æ –Ω–∞ Render
- ‚úÖ Webhook –±—É–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –∑ polling
- ‚úÖ –ü–æ–≤–Ω–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤

---

**–î–∞—Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: 2025-01-21  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û  
**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: –û—á—ñ–∫—É—î—Ç—å—Å—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ –ø—ñ—Å–ª—è –¥–µ–ø–ª–æ—é 